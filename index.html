<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Travel App - Designed by isonnn</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { --primary-red: #C41E3A; --bg: #F5F7FA; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; color: #333; -webkit-tap-highlight-color: transparent; }
        
        header { background: #fff; padding: 20px 25px; border-top: 10px solid var(--primary-red); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        header h1 { margin: 0; font-size: 1.4rem; color: #1a1a1a; font-weight: 800; }
        .subtitle-row { display: flex; justify-content: space-between; align-items: baseline; margin-top: 5px; }
        header p { margin: 0; color: #888; font-size: 0.9rem; font-weight: 500; }
        .credit-tag { font-size: 0.65rem; color: #ddd; font-style: italic; font-weight: 400; }

        .day-card { background: white; border-radius: 12px; margin: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.02); }
        .card-header { display: flex; height: 80px; cursor: pointer; }
        .header-left { background: var(--primary-red); color: white; width: 70px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .day-num { font-size: 1.4rem; font-weight: 900; }
        .day-date { font-size: 0.75rem; opacity: 0.9; }
        .header-right { flex: 1; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; }
        .day-info h3 { margin: 0; font-size: 1.1rem; font-weight: 700; }
        
        .card-body { display: none; padding: 20px; border-top: 1px solid #f8f8f8; }
        .day-card.open .card-body { display: block; }
        .day-card.open .fa-chevron-down { transform: rotate(180deg); color: var(--primary-red); }

        .timeline-item { position: relative; padding-left: 25px; border-left: 2px solid #eee; padding-bottom: 25px; }
        .timeline-item:last-child { border-left-color: transparent; }
        .timeline-dot { position: absolute; left: -7px; top: 2px; width: 12px; height: 12px; background: white; border: 3px solid var(--primary-red); border-radius: 50%; }
        .event-time { font-weight: 700; color: var(--primary-red); font-size: 0.85rem; font-family: monospace; }
        .event-title { font-weight: 800; font-size: 1rem; margin: 4px 0; color: #222; }
        .event-remark { font-size: 0.85rem; color: #666; line-height: 1.5; background: #f9f9f9; padding: 10px; border-radius: 6px; margin-top: 8px; }
        
        .nav-btn { display: inline-flex; align-items: center; gap: 5px; background: #fff; border: 1px solid #eee; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; text-decoration: none; color: #333; font-weight: 600; margin-top: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }

        .tab-bar { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 75%; max-width: 320px; background: white; border-radius: 50px; display: flex; padding: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000; }
        .tab-item { flex: 1; text-align: center; color: #aaa; padding: 8px 0; border-radius: 30px; font-size: 0.75rem; font-weight: bold; display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .tab-item.active { background: #FEE8EC; color: var(--primary-red); }
        .tab-icon { font-size: 1.1rem; }

        .loading { text-align: center; padding: 100px 0; color: #999; font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <h1 id="app-title">Ê≠£Âú®Âä†ËΩΩ...</h1>
        <div class="subtitle-row">
            <p id="app-subtitle">ÂêåÊ≠•‰∫ëÁ´ØÊï∞ÊçÆ‰∏≠</p>
            <span class="credit-tag">Designed by isonnn</span>
        </div>
    </header>

    <div id="itinerary-page">
        <div id="itinerary-container" class="loading">
            <i class="fas fa-sync fa-spin"></i><br><br>Ê≠£Âú®‰ªé Google Sheet ÂêåÊ≠•ÊúÄÊñ∞Ë°åÁ®ã...
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active">
            <span class="tab-icon">üìÖ</span>
            <span>Ë°åÁ®ã</span>
        </div>
        <div class="tab-item" onclick="alert('ÈÖíÂ∫óÊ®°ÂùóÂºÄÂèë‰∏≠...')">
            <span class="tab-icon">üè®</span>
            <span>ÈÖíÂ∫ó</span>
        </div>
        <div class="tab-item" onclick="alert('ËÆ∞Ë¥¶Ê®°ÂùóÂºÄÂèë‰∏≠...')">
            <span class="tab-icon">üí∞</span>
            <span>ËÆ∞Ë¥¶</span>
        </div>
    </div>

    <script>
        // === üö® ËØ∑Âú®Ê≠§Â§ÑÁ≤òË¥¥‰Ω†ÁöÑ Google Sheet CSV ÂèëÂ∏ÉÈìæÊé• üö® ===
        const csvUrl = '‰Ω†ÁöÑ_CSV_ÂèëÂ∏ÉÈìæÊé•_Â°´Âú®ËøôÈáå';

        window.onload = function() { fetchItinerary(); };

        function fetchItinerary() {
            if (!csvUrl || csvUrl.includes('Â°´Âú®ËøôÈáå')) {
                document.getElementById('itinerary-container').innerHTML = "‚ö†Ô∏è ËØ∑ÂÖàÂú®‰ª£Á†Å‰∏≠ÈÖçÁΩÆ CSV ÈìæÊé•„ÄÇ";
                return;
            }

            Papa.parse(csvUrl, {
                download: true,
                complete: function(results) {
                    const data = results.data;
                    
                    // 1. ËÆæÁΩÆ‰∏ªÂâØÊ†áÈ¢ò
                    if (data[0] && data[0][1]) document.getElementById('app-title').innerText = data[0][1];
                    if (data[1] && data[1][1]) document.getElementById('app-subtitle').innerText = data[1][1];
                    
                    // 2. Ëß£ÊûêÊï∞ÊçÆË°å (Ë∑≥ËøáÂâç 4 Ë°åÊ†áÈ¢ò‰∏éË°®Â§¥)
                    const rows = data.slice(4);
                    const groupedDays = groupItinerary(rows);
                    renderItinerary(groupedDays);
                },
                error: function() {
                    document.getElementById('itinerary-container').innerHTML = "‚ö†Ô∏è ËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü• Google Sheet ÁöÑ‚ÄúÂèëÂ∏ÉÂà∞ÁΩëÈ°µ‚ÄùËÆæÁΩÆ„ÄÇ";
                }
            });
        }

        function groupItinerary(rows) {
            let daysMap = new Map();

            rows.forEach(row => {
                let dayLabel = row[0]; // AÂàó: Day
                if (!dayLabel || dayLabel.trim() === "" || dayLabel === "Day") return;

                if (!daysMap.has(dayLabel)) {
                    daysMap.set(dayLabel, {
                        dayNum: dayLabel,
                        date: row[1],     // BÂàó: Date
                        location: row[3], // DÂàó: Location
                        events: []
                    });
                }

                // ÈÄÇÈÖçÂà†Èô§ Description ÂêéÁöÑÂàóÁ¥¢Âºï
                if (row[4]) { // EÂàó: Activity
                    daysMap.get(dayLabel).events.push({
                        time: row[2],     // CÂàó: Time
                        activity: row[4], // EÂàó: Activity
                        remarks: row[5],  // FÂàó: Remarks
                        mapUrl: row[6]    // GÂàó: Map Links
                    });
                }
            });
            return Array.from(daysMap.values());
        }

        function renderItinerary(days) {
            const container = document.getElementById('itinerary-container');
            container.innerHTML = '';

            if (days.length === 0) {
                container.innerHTML = "üì≠ ÊöÇÊó†ÊúâÊïàË°åÁ®ãÊï∞ÊçÆÔºåËØ∑Ê£ÄÊü•Ë°®Ê†ºÂÜÖÂÆπ„ÄÇ";
                return;
            }

            days.forEach(d => {
                const card = document.createElement('div');
                card.className = 'day-card';
                card.onclick = function() { this.classList.toggle('open'); };
                
                let timelineHtml = d.events.map(ev => `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="event-time">${ev.time || ''}</div>
                        <div class="event-title">${ev.activity}</div>
                        ${ev.remarks ? `<div class="event-remark">${ev.remarks}</div>` : ''}
                        ${ev.mapUrl && ev.mapUrl.startsWith('http') ? `<a href="${ev.mapUrl}" target="_blank" class="nav-btn"><i class="fas fa-location-arrow"></i> ÂØºËà™</a>` : ''}
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="card-header">
                        <div class="header-left">
                            <div class="day-num">${d.dayNum}</div>
                            <div class="day-date">${d.date}</div>
                        </div>
                        <div class="header-right">
                            <div class="day-info"><h3>${d.location || '‰ªäÊó•Ë°åÁ®ã'}</h3></div>
                            <i class="fas fa-chevron-down" style="color:#ddd; transition:0.3s"></i>
                        </div>
                    </div>
                    <div class="card-body">${timelineHtml}</div>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
